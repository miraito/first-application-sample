<!DOCTYPE HTML>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<title>game</title>
	<link type="text/css" rel="stylesheet" media="all" href="css/main.css">
	<script src="/js/enchant.js"></script>
	<script>
	enchant();
	var game;
	</script>
	<script src='js/map.js'></script>
	<script src='js/effect.js'></script>
	<script>console.log(zan);</script>
	<script>
	var chara3;
	window.onload = function(){
		game = new Game(800,448);
		game.preload('images/effect/zan1.png','images/effect/zan0.png','images/chara/19/3.png','images/map0.png','images/map/1.png','images/map0_1.png','images/icon0.png','images/icon/triangle_red.gif','images/effect/fire.png');
		game.rootScene.backgroundColor = 'black';
		game.onload = function(){
			function addlabel(){
				var label = new Label('test');
				label.backgroundColor = 'rgb(0,0,0)';
				label.color = 'red';
				//game.rootScene.addChild(label);
			}
			addlabel();

			var a = new Sprite(32,48);
			var tip = game.assets['images/map0.png'];
			var image = new Surface(16,48);
			image.draw(tip,448,208,32,48,0,0,32,48);
			a.image = image;
			//game.rootScene.addChild(a);
			
			var tip = function(){
				var tip = new Sprite(32,32);
				tip.image = game.assets['images/map/1.png'];
				tip.frame = 36;
				game.rootScene.addChild(tip);
			}
			//tip();
			var map1 = function(){
				var x = 22 * 32 ;
				var y = 15 * 32;
				var map = new Sprite( x,y );
				var tip = game.assets['images/map0.png'];
				var image = new Surface(x,y);
				for(var i = 0; i < x; i += 32){
					for(var j = 0; j < y; j += 32){
						image.draw(tip,240,64,48,48,i,j,32,32);
					}
				}

				// 上下壁
				var tip = game.assets['images/map/1.png'];
				for(var i = 32; i < x; i +=32){
					image.draw(tip,128,128,32,32,i,0,32,32);
					image.draw(tip,128,120,32,32,i,14*32,32,32);	
				}
				// 左端壁
				var tip = game.assets['images/map/1.png'];
				// for( var i = 0; i < y; i +=32 ){
				// 	image.draw(tip,96,128,32,32,0,i,32,32);	
				// }
				image.draw(tip,96,128,32,32,0,0,32,32);
				image.draw(tip,96,120,32,32,0,y-32,32,32);	
				// 右端壁
				var tip = game.assets['images/map/1.png'];
				for( var i = 0; i < y; i +=32 ){
					image.draw(tip,160,128,32,32,x-32,i,32,32);
				}
				// 柱
				image.draw(tip,16,240,64,96,32*3,32*2,64,96);

				// 障害物1
				var tip2 = game.assets['images/map0_1.png'];
				image.draw(tip2,448,208,32,48,32*2,32*2,32,32)
				



				map.image = image;
				map.moveTo(128,0);
				return map;
			}
			
			var map = map1();
			game.rootScene.addChild(map);

			var ball = new Sprite(16,16);
			ball.image = game.assets['images/icon0.png'];
			ball.frame = 19;
			ball.moveTo(32*10+16,32*6+16);
			game.rootScene.addChild(ball);

			var chara = new Sprite(32,32);
			chara.image = game.assets['images/chara/19/3.png'];
			game.rootScene.addChild(chara);
			chara.anim = [0,1,2]
			chara.addEventListener(Event.ENTER_FRAME,function(){
				if( this.age % 10 === 0 ){
					this.frame = this.anim[(this.age/10) % 3 ];
				}
			});

			var chara2 = new Sprite(32,32);
			chara2.image = game.assets['images/chara/19/3.png'];
			game.rootScene.addChild(chara2);
			chara2.anim = [3,4,5];
			chara2.moveTo(32,0);
			chara2.addEventListener(Event.ENTER_FRAME,function(){
				if( this.age % 10 === 0 ){
					this.frame = this.anim[(this.age/10) % 3];
				}
			});

			
			 chara3 = new Sprite(32,32);
			chara3.image = game.assets['images/chara/19/3.png'];
			game.rootScene.addChild(chara3);
			chara3.anim = [6,7];
			chara3.moveTo(128,128);
			//chara3.scale(2,2);
			chara3.addEventListener(Event.ENTER_FRAME,function(){
				// if( this.age % 10 === 0 ){
				// 	this.frame = this.anim[(this.age/10) % 2];
				// }
				//this.scaleX += 0.1;
			});

			
			game.rootScene.tl.then(function(){
				chara2.tl.moveTo(320,320,50);
			chara3.tl.moveTo(320,320,50);	
			})

			var zan = new Sprite(120,120);
			zan.image = game.assets['images/effect/zan0.png'];
			zan.moveTo( 0,32 );
			game.rootScene.addChild(zan);
			zan.flag = true;
			zan.addEventListener(Event.ENTER_FRAME,function(){
				if(this.flag == true){
					if(this.age % 1 === 0){
						this.frame = (this.age/1) % 10;
					}
					if(this.frame === 9){
						this.flag = false;
						game.rootScene.removeChild(this);	
					}
				}
				if(zan.frame === 5)game.rootScene.addChild(zan1);
				
			});
			var zan1 = new Sprite(120,120);
			zan1.image = game.assets['images/effect/zan1.png'];
			zan1.moveTo( 0,32 );
			
			zan1.flag = true;
			zan1.addEventListener(Event.ENTER_FRAME,function(){
				if(this.flag == true){
					if(this.age % 1 === 0){
						this.frame = (this.age/1) % 10;
					}
					if(this.frame === 9){
						this.flag = false;
						game.rootScene.removeChild(this);	
					}
				}
				
			});

			var triangle = new Sprite(16,16);
			var image = new Surface(16,16);
			var tip = game.assets['images/icon/triangle_red.gif'];
			image.draw(tip,0,0,11,11,0,0,16,16);
			triangle.image = image;
			triangle.moveTo(64,250);
			game.rootScene.addChild(triangle);

			var t_text = new Label('1');
			t_text.moveTo(85,253);
			t_text.color = 'white';
			game.rootScene.addChild(t_text);

			// var firee = fire();
			// firee.moveTo(300,300);
			// game.rootScene.addChild(firee);

		};
		game.start();
	};
	</script>
	<script src="js/game.js"></script>
	<script src="js/test.js"></script>
</head>
<body>

</body>
</html>